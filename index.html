<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TWIN.</title>

  <!-- Performance optimizations -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="preload" href="dark.css?v=13" as="style">
  <link rel="preload" href="theme-toggle.js?v=13" as="script">
  <link rel="preload" href="script.js?v=31" as="script">
  
  <!-- this will be the default theme -->
  <link id="themeCss" rel="stylesheet" href="dark.css?v=13"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>

  <style>
  /* Prevent flash of unstyled content */
  html {
    margin: 0;
    padding: 0;
  }
  
  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
  }
  
  /* Notification Modal */
  .notification-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    z-index: 99999;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .notification-overlay.show {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
  }
  body[data-theme="light"] .preset-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    border-color: rgba(0, 0, 0, 0.4);
  }
  
  body[data-theme="royal"] .notification-modal button,
  body[data-theme="dark"] .notification-modal button {
    background: linear-gradient(135deg, #ff5ea8 0%, #ff3366 100%);
  }
  
  body[data-theme="monochrome"] .notification-modal button {
    background: #22c55e;
  }
  
  body[data-theme="liquidglass"] .notification-modal {
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(30px);
    border-color: rgba(255, 255, 255, 0.2);
  }
  
  /* Light theme - black menu icon */
  body[data-theme="light"] .menu-btn span {
    background: #000000 !important;
  }
  
  body[data-theme="liquidglass"] .stock-suggestions {
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(30px);
    border-color: rgba(255, 255, 255, 0.2);
  }
  
  /* Menu button - bottom right */
  .menu-fab { 
    position: fixed; 
    right: 24px; 
    bottom: 24px; 
    z-index: 9999; 
  }

  .menu-btn {
    width: 48px; 
    height: 48px; 
    border: 0; 
    border-radius: 12px; 
    cursor: pointer;
    background: transparent;
    backdrop-filter: none;
    box-shadow: none;
    display: grid; 
    place-items: center;
    transition: transform .25s ease;
  }

  .menu-btn:hover { 
    transform: rotate(180deg);
  }

  .menu-btn span { 
    display: block; 
    width: 24px; 
    height: 3px; 
    margin: 3px 0; 
    background: #fff; 
    border-radius: 2px;
    transition: transform .25s ease, opacity .25s ease;
  }
  
  .menu-btn.open span:nth-child(1) { transform: rotate(45deg) translateY(9px); }
  .menu-btn.open span:nth-child(2) { opacity: 0; }
  .menu-btn.open span:nth-child(3) { transform: rotate(-45deg) translateY(-9px); }

  /* Menu panel - minimal text only, right above menu button */
  .menu-options {
    position: fixed;
    bottom: 80px;
    right: 24px;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    justify-content: flex-start;
    gap: 32px;
    background: transparent;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border-radius: 0;
    border: none;
    box-shadow: none;
    z-index: 10000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    padding: 0;
  }
  
  .menu-options.open {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  .menu-options button,
  .menu-logout-btn {
    padding: 0;
    margin: 0;
    border: none;
    background: transparent;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    color: var(--ink, #ffffff);
    text-align: right;
    transition: all 0.2s ease;
    border-radius: 0;
    position: relative;
    white-space: nowrap;
  }
  
  .menu-options button:hover,
  .menu-logout-btn:hover {
    opacity: 0.7;
    transform: translateX(-2px);
  }
  
  .menu-logout-btn {
    margin-bottom: 20px;
  }
  
  .menu-user-name {
    padding: 0;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--ink, rgba(255, 255, 255, 0.5));
    opacity: 0.5;
    text-align: right;
    margin-bottom: 20px;
  }

  /* Theme toggle circle - top left */
  .theme-toggle-circle {
    position: fixed;
    left: 24px;
    top: 24px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,.3);
    cursor: pointer;
    transition: all .25s ease;
    z-index: 9999;
    box-shadow: 0 4px 16px rgba(0,0,0,.3);
  }
  .theme-toggle-circle:hover {
    transform: scale(1.1);
    border-color: rgba(255,255,255,.5);
    box-shadow: 0 6px 24px rgba(0,0,0,.4);
  }
  
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    backdrop-filter: blur(2px);
    display: none;         
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    transition: opacity .22s ease;
  }
  .modal-overlay.open { display: flex; }
  .modal-overlay.fade-in { opacity: 1; }

  .modal {
    width: min(720px, 90vw);
    border-radius: 16px;
    background: rgba(10,10,10,.72);
    color: #fff;
    border: 1px solid rgba(255,255,255,.18);
    box-shadow: 0 20px 40px rgba(0,0,0,.35);
    transform: translateY(8px) scale(.98);
    transition: transform .22s ease, opacity .22s ease;
    opacity: 0;
  }
  .modal.show {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  .modal-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 18px;
    border-bottom: 1px solid rgba(255,255,255,.16);
    font-weight: 800;
    letter-spacing: .25px;
  }
  .modal-body {
    padding: 16px 18px 18px 18px;
    line-height: 1.55;
  }
  .modal-close {
    border: 1px solid rgba(255,255,255,.35);
    background: transparent;
    color: #fff;
    border-radius: 10px;
    padding: 8px 10px;
    cursor: pointer;
    font-weight: 700;
    transition: filter .18s ease, transform .12s ease;
  }
  .modal-close:hover { filter: brightness(1.05); transform: translateY(-1px); }
  
  /* Stock Suggestions Dropdown */
  .stock-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgba(10, 10, 10, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    margin-top: 8px;
    max-height: 400px;
    overflow-y: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
    z-index: 1000;
    animation: slideDown 0.3s ease;
  }
  
  .stock-suggestions::-webkit-scrollbar {
    display: none;
  }
  
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .suggestions-header {
    padding: 12px 16px;
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    opacity: 0.6;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .stock-card {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }
  
  .stock-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateX(4px);
  }
  
  .stock-logo {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-right: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
  
  .stock-info {
    flex: 1;
  }
  
  .stock-name {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
  }
  
  .stock-ticker {
    font-size: 11px;
    opacity: 0.6;
    font-weight: 500;
    letter-spacing: 0.5px;
  }
  
  /* Duration Presets */
  .duration-presets {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: flex-start;
    animation: fadeIn 0.3s ease;
  }
  
  .preset-label {
    font-size: 12px;
    font-weight: 600;
    opacity: 0.7;
    margin-right: 8px;
  }
  
  .preset-btn {
    padding: 8px 16px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.05);
    color: #fff;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: fit-content;
    max-width: fit-content;
    width: auto;
    white-space: nowrap;
    flex-shrink: 0;
    flex-grow: 0;
  }
  
  .preset-btn:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.4);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transform: none !important;
    scale: 1 !important;
  }
  
  .preset-btn:active {
    transform: translateY(0) !important;
  }
  
  /* Theme-specific modal styles */
  body[data-theme=\"light\"] .notification-modal {
    background: rgba(255, 255, 255, 0.95);
    border-color: rgba(0, 0, 0, 0.1);
    color: #1b2742;
  }
  
  body[data-theme=\"light\"] .notification-modal h3 {
    color: #1b2742;
  }
  
  body[data-theme=\"light\"] .notification-modal p {
    color: rgba(27, 39, 66, 0.8);
  }
  
  body[data-theme=\"light\"] .notification-modal button {
    background: linear-gradient(135deg, #B9A2E5 0%, #9b7fcf 100%);
  }
  
  body[data-theme=\"light\"] .stock-suggestions {
    background: rgba(255, 255, 255, 0.95);
    border-color: rgba(0, 0, 0, 0.15);
    color: #1b2742;
  }
  
  body[data-theme=\"light\"] .stock-name,
  body[data-theme=\"light\"] .stock-ticker {
    color: #1b2742;
  }
  
  body[data-theme=\"light\"] .stock-card:hover {
    background: rgba(0, 0, 0, 0.05);
  }
  
  body[data-theme=\"light\"] .preset-btn {
    border-color: rgba(0, 0, 0, 0.2);
    background: rgba(0, 0, 0, 0.05);
    color: #1b2742;
  }
  
  body[data-theme=\"light\"] .preset-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    border-color: rgba(0, 0, 0, 0.4);
  }
  
  body[data-theme=\"royal\"] .notification-modal button,
  body[data-theme=\"dark\"] .notification-modal button {
    background: linear-gradient(135deg, #ff5ea8 0%, #ff3366 100%);
  }
  
  body[data-theme=\"monochrome\"] .notification-modal button {
    background: #22c55e;
  }
  
  body[data-theme=\"liquidglass\"] .notification-modal {
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(30px);
    border-color: rgba(255, 255, 255, 0.2);
  }
  
  body[data-theme=\"liquidglass\"] .stock-suggestions {
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(30px);
    border-color: rgba(255, 255, 255, 0.2);
  }

  /* Menu overlay - behind the menu options */
  .menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: transparent;
    backdrop-filter: none;
    display: none;
    z-index: 9998;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .menu-overlay.open {
    display: block;
    opacity: 1;
  }
</style>

</head>
<body>
  <script>
    // Apply theme-specific classes to body on load
    document.addEventListener('DOMContentLoaded', () => {
      const theme = localStorage.getItem('twin_theme_css') || 'dark.css';
      const themeName = theme.replace('.css', '');
      document.body.setAttribute('data-theme', themeName);
      
      // Load predictions on page load to enable PREDICTIONS button
      if (window.getSavedPredictions) {
        window.getSavedPredictions().then(predictions => {
          console.log(`Loaded ${predictions.length} predictions from database`);
          // This will enable the PREDICTIONS button if predictions exist
        }).catch(err => {
          console.error('Failed to load predictions:', err);
        });
      }
      
      // Update on theme change  
      setInterval(() => {
        const currentTheme = localStorage.getItem('twin_theme_css') || 'dark.css';
        const currentThemeName = currentTheme.replace('.css', '');
        if (document.body.getAttribute('data-theme') !== currentThemeName) {
          document.body.setAttribute('data-theme', currentThemeName);
        }
      }, 500);
    });
  </script>
  <div class="shell">
    <div class="topbar">
      <div class="controls">
        <div class="input-group" style="position: relative;">
          <input
            id="userInput"
            type="text"
            placeholder="Enter a stock and a duration to receive a prediction e.g., Apple in 3 days, NVDA next week"
          /> 
          <button class="btn-both-inside" onclick="sendTwin()">TWIN</button>
          
          <!-- Stock Suggestions Dropdown -->
          <div id="stockSuggestions" class="stock-suggestions" style="display: none;">
            <div class="suggestions-header">Popular Stocks</div>
            <div class="stock-card" onclick="selectStock('Apple', 'AAPL')">
              <div class="stock-info">
                <div class="stock-name">Apple Inc.</div>
                <div class="stock-ticker">AAPL</div>
              </div>
            </div>
            <div class="stock-card" onclick="selectStock('Tesla', 'TSLA')">
            
              <div class="stock-info">
                <div class="stock-name">Tesla Inc.</div>
                <div class="stock-ticker">TSLA</div>
              </div>
            </div>
            <div class="stock-card" onclick="selectStock('Microsoft', 'MSFT')">
              <div class="stock-info">
                <div class="stock-name">Microsoft Corp.</div>
                <div class="stock-ticker">MSFT</div>
              </div>
            </div>
            <div class="stock-card" onclick="selectStock('NVIDIA', 'NVDA')">
              <div class="stock-info">
                <div class="stock-name">NVIDIA Corp.</div>
                <div class="stock-ticker">NVDA</div>
              </div>
            </div>
            <div class="stock-card" onclick="selectStock('Amazon', 'AMZN')">
              
              <div class="stock-info">
                <div class="stock-name">Amazon.com Inc.</div>
                <div class="stock-ticker">AMZN</div>
              </div>
            </div>
            <div class="stock-card" onclick="selectStock('Google', 'GOOGL')">
              
              <div class="stock-info">
                <div class="stock-name">Alphabet Inc.</div>
                <div class="stock-ticker">GOOGL</div>
              </div>
            </div>
          </div>
          
          <!-- Duration Presets -->
          <div id="durationPresets" class="duration-presets" style="display: none;">
            <div class="preset-label">Quick select duration:</div>
            <button class="preset-btn" onclick="selectDuration('3 days')">3 days</button>
            <button class="preset-btn" onclick="selectDuration('1 week')">1 week</button>
            <button class="preset-btn" onclick="selectDuration('2 weeks')">2 weeks</button>
            <button class="preset-btn" onclick="selectDuration('1 month')">1 month</button>
            <button class="preset-btn" onclick="selectDuration('3 months')">3 months</button>
          </div>
        </div>
        <button class="btn btn-plus" onclick="sendBasic()">Analyze with TWIN-</button>
      </div>
      <div class="brand" style="display: flex; align-items: center; gap: 10px;">
        <h1 class="app-title">TWIN.</h1>
        <i class="fas fa-chart-line"></i>
      </div>
    </div>

  
    <div class="grid">
      <section class="card">
        <header class="card-head">
          <h2>TWIN-</h2>
          <p class="muted">Fast forecast</p>
        </header>
        <div class="chatbox big">
          <div id="messages-basic" class="messages"></div>
        </div>
      </section>

<!-- TWIN PLUS SECTION -->
      <section class="card card-plus">
        <header class="card-head card-head-plus">
          <h2>TWIN+</h2>
          <p class="muted">ML + Diagnostics</p>
        </header>
        <div class="chatbox big">
          <div id="messages-plus" class="messages"></div>
        </div>
      </section>
    </div>
  </div>


  <!-- Theme toggle circle -->
  <div id="themeToggle" class="theme-toggle-circle"></div>

  <!-- Menu options - slide in from right -->
  <div id="menuOptions" class="menu-options">
    <button id="menuHome" class="menu-logout-btn">HOME</button>
    <div id="menuUserName" class="menu-user-name" style="display: none;"></div>
    <button id="menuNew">CLEAR</button>
    <button id="menuPredictions">PREDICTIONS</button>
    <button id="menuHowTo">HOW TO USE</button>
    <button id="menuWhatIs">TWIN?</button>
  </div>

  <!-- Menu button -->
  <div class="menu-fab">
    <button id="menuBtn" class="menu-btn" aria-label="Menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>
  </div>

  <!-- Menu overlay for click-to-close -->
  <div id="menuOverlay" class="menu-overlay"></div>


  <div id="modalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div id="modal" class="modal" tabindex="-1">
      <div class="modal-head">
        <span id="modalTitle">Title</span>
        <button id="modalClose" class="modal-close" type="button">Close</button>
      </div>
      <div id="modalBody" class="modal-body"></div>
    </div>
  </div>


  <!-- Load scripts at the end so onclick handlers work -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Initialize Supabase client for auth management
    window.supabaseClient = null;
    
    fetch('/api/config')
      .then(res => res.json())
      .then(config => {
        if (config.supabaseUrl && config.supabaseUrl !== 'YOUR_SUPABASE_URL_HERE') {
          window.supabaseClient = supabase.createClient(config.supabaseUrl, config.supabaseKey);
          console.log('Supabase client initialized');
        }
      })
      .catch(err => console.error('Failed to load Supabase config:', err));
  </script>
  <script src="theme-toggle.js?v=14"></script>
  <script src="script.js?v=31"></script>
  <script>document.addEventListener('DOMContentLoaded', function(){ if(window.initMenu) window.initMenu(); });</script>
</body>
</html>


